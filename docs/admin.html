<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zina Admin - Panou de Administrare</title>
  <link rel="icon" type="image/png" href="logos/ZinA%20Logos-04.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-logo">
        <img src="logos/ZinA%20Logos-07.png" alt="ZusammenInAustria" class="logo-img">
        <span class="logo-text">Zina</span>
      </a>
      <div class="nav-links">
        <a href="index.html" class="nav-link">Ãnapoi la site</a>
      </div>
    </div>
  </nav>

  <div id="login-modal" class="modal" style="display: flex;">
    <div class="modal-content">
      <h2>Autentificare Admin</h2>
      <p class="muted">Te rugÄƒm sÄƒ te autentifici pentru a accesa panoul de administrare.</p>
      <form id="login-form" class="stack">
        <label class="stack">
          <span>Email</span>
          <input type="email" id="login-email" required placeholder="email@example.com" autocomplete="email">
        </label>
        <label class="stack">
          <span>ParolÄƒ</span>
          <input type="password" id="login-password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
        </label>
        <div id="login-error" class="error-message" style="display: none;"></div>
        <div class="actions">
          <button type="submit" class="button">Autentificare</button>
        </div>
      </form>
    </div>
  </div>

  <header class="hero hero-small" id="admin-header" style="display: none;">
    <div class="hero-content">
      <div class="hero-panel">
        <p class="eyebrow">Admin</p>
        <h1>Panou de Administrare</h1>
        <p class="lead">Gestionare conÈ›inut pentru ZusammenInAustria.</p>
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
          <span id="user-info" class="muted"></span>
          <button id="logout-btn" class="button ghost">Deconectare</button>
          <a class="button ghost" href="index.html">Ãnapoi la site</a>
        </div>
      </div>
    </div>
  </header>

  <main class="content" id="admin-content" style="display: none;">
    <div class="cta-grid" style="max-width: 800px; margin: 0 auto;">
      <a href="admin-articles.html" class="cta-card">
        <span class="cta-icon">ğŸ“</span>
        <h3>Gestionare Articole</h3>
        <p class="muted">CreeazÄƒ, editeazÄƒ È™i publicÄƒ articole pentru comunitate</p>
        <span class="cta-link">Deschide â†’</span>
      </a>
      <a href="admin-events.html" class="cta-card">
        <span class="cta-icon">ğŸ“…</span>
        <h3>Gestionare Evenimente</h3>
        <p class="muted">OrganizeazÄƒ È™i publicÄƒ evenimente ale comunitÄƒÈ›ii</p>
        <span class="cta-link">Deschide â†’</span>
      </a>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <p>Ai nevoie de ajutor? ContacteazÄƒ-ne la zina.vienna@example.org</p>
    </div>
  </footer>

  <script src="auth-service.js"></script>
  <script>
    const loginModal = document.getElementById('login-modal');
    const loginForm = document.getElementById('login-form');
    const loginEmail = document.getElementById('login-email');
    const loginPassword = document.getElementById('login-password');
    const loginError = document.getElementById('login-error');
    const adminHeader = document.getElementById('admin-header');
    const adminContent = document.getElementById('admin-content');
    const userInfo = document.getElementById('user-info');
    const logoutBtn = document.getElementById('logout-btn');

    let currentUser = null;
    let authChecked = false;

    async function checkAuth() {
      if (authChecked) return;
      try {
        if (typeof AuthService === 'undefined') await new Promise(r => setTimeout(r, 100));
        currentUser = await AuthService.getCurrentUser();
        if (currentUser) {
          loginModal.style.display = 'none';
          adminHeader.style.display = 'block';
          adminContent.style.display = 'block';
          userInfo.textContent = `Conectat: ${currentUser.email}`;
        } else {
          loginModal.style.display = 'flex';
          adminHeader.style.display = 'none';
          adminContent.style.display = 'none';
        }
        authChecked = true;
      } catch (e) {
        console.error(e);
        loginModal.style.display = 'flex';
        authChecked = true;
      }
    }

    function showPanel() {
      loginModal.style.display = 'none';
      adminHeader.style.display = 'block';
      adminContent.style.display = 'block';
      if (currentUser) userInfo.textContent = `Conectat: ${currentUser.email}`;
    }

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      loginError.style.display = 'none';
      try {
        const result = await AuthService.signIn(loginEmail.value, loginPassword.value);
        if (result.user) {
          currentUser = result.user;
          await new Promise(r => setTimeout(r, 200));
          showPanel();
        }
      } catch (err) {
        loginError.textContent = err.message || 'Email sau parolÄƒ incorectÄƒ.';
        loginError.style.display = 'block';
      }
    });

    logoutBtn.addEventListener('click', async () => {
      await AuthService.signOut();
      currentUser = null;
      loginModal.style.display = 'flex';
      adminHeader.style.display = 'none';
      adminContent.style.display = 'none';
      loginEmail.value = '';
      loginPassword.value = '';
    });

    AuthService.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_OUT') {
        currentUser = null;
        loginModal.style.display = 'flex';
        adminHeader.style.display = 'none';
        adminContent.style.display = 'none';
      } else if (event === 'SIGNED_IN' && session?.user) {
        currentUser = session.user;
        showPanel();
      }
    });

    (async function init() {
      let n = 0;
      while (typeof window.supabase === 'undefined' && n < 50) {
        await new Promise(r => setTimeout(r, 100));
        n++;
      }
      await checkAuth();
    })();
  </script>
</body>
</html>
