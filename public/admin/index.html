<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zina Admin | Decap CMS</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="cms-shell">
  <header class="hero hero-small">
    <div class="hero-content">
      <div class="hero-panel">
        <p class="eyebrow">Admin</p>
        <h1>Article Editor</h1>
        <p class="lead">Manage Zina articles with Netlify Identity + Git Gateway.</p>
        <div class="actions">
          <a class="button ghost" href="/">Back to Site</a>
          <button id="cms-login" type="button" class="button">Login</button>
          <button id="cms-logout" type="button" class="button ghost">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <main class="content">
    <div class="panel">
      <p class="muted">The editor loads after successful Netlify Identity login. Invited users can publish directly through Git Gateway without GitHub access.</p>
      <noscript>
        <p class="muted">JavaScript is required to use the admin panel.</p>
      </noscript>
    </div>
  </main>

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    const loginButton = document.getElementById('cms-login');
    const logoutButton = document.getElementById('cms-logout');

    function updateButtons(userPresent) {
      if (!loginButton || !logoutButton) return;
      loginButton.style.display = userPresent ? 'none' : 'inline-flex';
      logoutButton.style.display = userPresent ? 'inline-flex' : 'none';
    }

    if (window.netlifyIdentity) {
      window.netlifyIdentity.on('init', (user) => {
        updateButtons(Boolean(user));
        if (!user) {
          window.netlifyIdentity.on('login', () => {
            document.location.href = '/admin/';
          });
          window.netlifyIdentity.open();
        }
      });

      window.netlifyIdentity.on('logout', () => {
        updateButtons(false);
        document.location.href = '/';
      });

      loginButton?.addEventListener('click', () => window.netlifyIdentity.open());
      logoutButton?.addEventListener('click', () => window.netlifyIdentity.logout());

      window.netlifyIdentity.init({ locale: 'en' });
    }
  </script>
</body>
</html>
